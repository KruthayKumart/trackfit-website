<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title> üìà Weight Line Graph</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111c28;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    h2 {
      color: #2ba8b8;
      margin-bottom: 20px;
    }
    #previousEntriesContainer {
      margin-top: 30px;
      border: 1px solid #2ba8b8;
      border-radius: 6px;
      max-width: 800px;
      background-color: #1c2b3a;
      padding: 16px;
      margin-left: auto;
      margin-right: auto;
      display: none;
      text-align: left;
    }
    #previousEntriesContainer h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-weight: 700;
      color: #2ba8b8;
      text-align: center;
    }
    #entriesList {
      list-style-type: decimal !important;
      list-style-position: inside !important;
      padding-left: 0;
      max-height: 200px;
      overflow-y: auto;
      margin: 0;
      color: #fff;
      font-weight: 600;
    }
    #entriesList li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #2ba8b8;
      cursor: pointer;
      user-select: none;
    }
    #entriesList li:last-child {
      border-bottom: none;
    }
    #entriesList li:hover {
      background-color: #2ba8b8;
      color: #111c28;
    }
    .delete-entry-btn {
      background: transparent;
      border: none;
      color: #e03e3e;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      user-select: none;
      transition: color 0.3s;
    }
    .delete-entry-btn:hover {
      color: #b62b2b;
    }
    button {
      margin-right: 8px;
      margin-top: 10px;
      background: #2ba8b8;
      border: none;
      color: #111c28;
      font-weight: bold;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background: #1a7280;
      color: white;
    }
    button.clear-btn, button.reset-btn {
      background: #e03e3e;
      color: #fff;
    }
    button.clear-btn:hover, button.reset-btn:hover {
      background: #b62b2b;
    }
    input, select {
      padding: 6px 8px;
      margin-right: 12px;
      border-radius: 5px;
      border: 1px solid #2ba8b8;
      background: #1c2b3a;
      color: #fff;
      font-weight: 600;
      width: 110px;
    }
    input[type="number"] {
      width: 120px;
    }
    label {
      margin-right: 6px;
    }
    #weightChart {
      background:#1c2b3a;
      margin: 30px auto;
      border-radius:8px;
      max-width:800px;
      width:100%;
      height:400px;
    }
    #inputContainer {
      margin: 0 auto 20px auto;
      max-width: 800px;
    }
    #buttonsContainer {
      margin: 10px auto 0 auto;
      max-width: 800px;
      text-align: center;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      max-width: 1000px;
      margin: 40px auto;
    }
    .nav-buttons a {
      background-color: #2ba8b8;
      color: #0f1928;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .nav-buttons a:hover {
      background-color: #1d7c88;
    }
  </style>
</head>
<body>

  <h2>üìà Weight Line Graph</h2>

  <div id="inputContainer">
    <label for="monthSelect">üìÜ Month:</label>
    <select id="monthSelect"></select>

    <label for="yearSelect">üìÖ Year:</label>
    <select id="yearSelect"></select>

    <label for="weightInput">‚öñÔ∏è Weight (kg):</label>
    <input type="number" id="weightInput" min="0" max="500" step="0.1" placeholder="e.g. 75.5" />
  </div>

  <div id="buttonsContainer">
    <button id="updateBtn">üìà Update Chart</button>
    <button id="clearBtn" class="clear-btn">üßΩ Clear</button>
    <button id="resetZoomBtn">üîç Reset Zoom</button>
    <button id="toggleEntriesBtn">‚úèÔ∏è Edit Previous Entries</button>
    <button id="resetBtn" class="reset-btn">üîÑ Reset</button>
  </div>

  <canvas id="weightChart"></canvas>

  <div id="previousEntriesContainer">
    <h3>üìù Previous Entered Values</h3>
    <ul id="entriesList"></ul>
  </div>
  

  <script>
    const monthSelect = document.getElementById('monthSelect');
    const yearSelect = document.getElementById('yearSelect');
    const weightInput = document.getElementById('weightInput');

    const updateBtn = document.getElementById('updateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const toggleEntriesBtn = document.getElementById('toggleEntriesBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resetZoomBtn = document.getElementById('resetZoomBtn');

    const previousEntriesContainer = document.getElementById('previousEntriesContainer');
    const entriesList = document.getElementById('entriesList');
    const inputContainer = document.getElementById('inputContainer');

    const currentYear = new Date().getFullYear();
    const currentMonth = new Date().getMonth();

    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    monthNames.forEach((m, i) => {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = m;
      monthSelect.appendChild(option);
    });

    for(let y = 2000; y <= 2100; y++) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = y;
      yearSelect.appendChild(option);
    }

    function resetInputsToDefault() {
      monthSelect.value = currentMonth;
      yearSelect.value = currentYear;
      weightInput.value = "";
    }

    resetInputsToDefault();

    let weightData = JSON.parse(localStorage.getItem('weightTimeline')) || {};

    const ctx = document.getElementById('weightChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: [{
          label: 'Weight (kg)',
          data: [],
          borderColor: '#2ba8b8',
          backgroundColor: 'rgba(43,168,184,0.2)',
          fill: true,
          tension: 0,  // straight lines
          pointRadius: 5,
          pointHoverRadius: 7,
        }]
      },
      options: {
        responsive: true,
        interaction: { mode: 'nearest', intersect: false },
        plugins: {
          legend: { labels: { color: '#2ba8b8', font: { size: 16, weight: 'bold' } } },
          tooltip: {
            callbacks: {
              title: ctx => new Date(ctx[0].parsed.x).toLocaleString('default', {month:'long', year:'numeric'}),
              label: ctx => ctx.parsed.y + ' kg'
            }
          },
          zoom: {
            zoom: {
              wheel: { enabled: true },
              pinch: { enabled: true },
              mode: 'x',
            },
            pan: {
              enabled: true,
              mode: 'x',
            }
          }
        },
        scales: {
          x: {
            type: 'time',
            time: { unit: 'month', tooltipFormat: 'MMMM yyyy' },
            ticks: { color: '#2ba8b8', font: { weight: 'bold' } },
            grid: { 
              color: '#1a2c3f',
              borderColor: '#2ba8b8',
              drawTicks: true,
              drawOnChartArea: true,
              drawBorder: true,
              tickLength: 10,
              lineWidth: 1,
              drawVertical: true
            },
          },
          y: {
            beginAtZero: false,
            ticks: { color: '#2ba8b8', font: { weight: 'bold' } },
            grid: { 
              color: '#1a2c3f', 
              borderColor: '#2ba8b8', 
              drawTicks: true,
              drawOnChartArea: true,
              drawBorder: true,
              lineWidth: 1
            }
          }
        }
      }
    });

    function getChartData() {
      const dataPoints = [];
      for(const key in weightData) {
        const [year, month] = key.split('-').map(Number);
        dataPoints.push({
          x: new Date(year, month, 1),
          y: weightData[key]
        });
      }
      dataPoints.sort((a,b) => a.x - b.x);
      return dataPoints;
    }

    function renderChart() {
      chart.data.datasets[0].data = getChartData();
      chart.update();
    }

    function saveData() {
      localStorage.setItem('weightTimeline', JSON.stringify(weightData));
    }

    function updateEntriesList() {
      entriesList.innerHTML = '';
      const keysSorted = Object.keys(weightData).sort();

      if(keysSorted.length === 0) {
        previousEntriesContainer.style.display = 'none';
        toggleEntriesBtn.textContent = "‚úèÔ∏è Edit Previous Entries";
        return;
      }

      keysSorted.forEach((key) => {
        const li = document.createElement('li');
        const [year, month] = key.split('-').map(Number);
        const dateText = `${monthNames[month]} ${year} ‚Äî ${weightData[key]} kg`;
        li.textContent = dateText;
        li.title = "Click to edit this entry";

        li.addEventListener('click', () => {
          monthSelect.value = month;
          yearSelect.value = year;
          weightInput.value = weightData[key];
          // Scroll smoothly to input container
          inputContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        const delBtn = document.createElement('button');
        delBtn.textContent = '‚ùå';
        delBtn.className = 'delete-entry-btn';
        delBtn.title = `Delete entry for ${monthNames[month]} ${year}`;
        delBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if(confirm(`Delete entry for ${monthNames[month]} ${year}?`)) {
            delete weightData[key];
            saveData();
            updateEntriesList();
            renderChart();
          }
        });

        li.appendChild(delBtn);
        entriesList.appendChild(li);
      });
    }

    function addWeightData() {
      let month = parseInt(monthSelect.value);
      let year = parseInt(yearSelect.value);
      let weight = parseFloat(weightInput.value);

      if(isNaN(weight) || weight <= 0) {
        alert("Please enter a valid weight greater than 0.");
        return;
      }

      const key = `${year.toString().padStart(4,'0')}-${month.toString().padStart(2,'0')}`;
      weightData[key] = weight;
      saveData();
      renderChart();
      updateEntriesList();

      resetInputsToDefault();
    }

    function clearInputsOnly() {
      resetInputsToDefault();
    }

    function resetAllData() {
      if(confirm("Are you sure you want to reset all saved data? This cannot be undone.")) {
        weightData = {};
        saveData();
        renderChart();
        updateEntriesList();
        resetInputsToDefault();
        previousEntriesContainer.style.display = 'none';
        toggleEntriesBtn.textContent = "‚úèÔ∏è Edit Previous Entries";
      }
    }

    function toggleEntriesVisibility() {
      if(previousEntriesContainer.style.display === 'block') {
        previousEntriesContainer.style.display = 'none';
        toggleEntriesBtn.textContent = "‚úèÔ∏è Edit Previous Entries";
      } else {
        updateEntriesList();
        previousEntriesContainer.style.display = 'block';
        toggleEntriesBtn.textContent = "‚¨áÔ∏è Hide Previous Entries";
        previousEntriesContainer.scrollIntoView({behavior: "smooth"});
      }
    }

    function resetWeightZoom() {
      chart.resetZoom();
    }

    updateBtn.addEventListener('click', addWeightData);
    clearBtn.addEventListener('click', clearInputsOnly);
    toggleEntriesBtn.addEventListener('click', toggleEntriesVisibility);
    resetBtn.addEventListener('click', resetAllData);
    resetZoomBtn.addEventListener('click', resetWeightZoom);

    renderChart();
    updateEntriesList();
  </script>
  <div class="nav-buttons">
    <a href="trackfit.html">‚Üê Home</a>
    <a href="dataview2.html">Sleep Log ‚Üí</a>
  </div>

</body>
</html>
