<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> Visual Progress</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="track-fit-icon.png"> <!-- Favicon -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body { background-color: #0f1928; color: white; }
    input[type="file"] { display: none; }
    label.upload-btn {
      background-color: #2ba8b8;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      cursor: pointer;
      display: inline-block;
    }
    .img-box img {
      max-height: 120px;
      object-fit: contain;
      border: 1px solid #2ba8b8;
      padding: 5px;
    }
    .saved-img {
      width: 300px;
      height: 400px;
      object-fit: cover;
      object-position: center;
    }
    .logo-img {
      width: 300px;
      height: 400px;
      object-fit: contain;
      border: 1px solid #2ba8b8;
    }
    #saveBtn:disabled, #compareBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
    }
    .modal-content {
      background-color: #111c28;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #2ba8b8;
      border-radius: 0.375rem;
      max-width: 90%;
      width: 800px;
    }
    .close-btn {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
      color: #2ba8b8;
    }
    .header-logo {
      max-width: 150px;
      height: auto;
    }
    /* Main container styles */
    .main-container {
      max-width: 900px; /* Set a max-width for content */
      margin: 50px auto; /* Center the container with top margin */
      background-color: #111c28; /* Slightly lighter background than body */
      padding: 30px; /* Internal padding */
      border-radius: 12px; /* Rounded corners */
      box-shadow: 0 0 10px rgba(43, 168, 184, 0.3); /* Subtle blue shadow */
    }
    /* New: Saved Progress container styles */
    .saved-progress-container {
      max-width: 1050px; /* Increased width to fit 3 images in a line + gaps */
      margin: 50px auto; /* Add margin to separate from other sections */
      background-color: #111c28; /* Same background as main container */
      padding: 30px; /* Same padding as main container */
      border-radius: 12px; /* Same rounded corners as main container */
      box-shadow: 0 0 10px rgba(43, 168, 184, 0.3); /* Same shadow as main container */
    }
  </style>
</head>
<body class="p-6 space-y-12">
  <div class="main-container">
    <!-- Logo -->
   

    <h2 class="text-2xl font-bold text-[#25a1c2] mb-4 text-center">Visual Progress</h2>

    <!-- Upload and Calendar -->
    <div class="space-y-8">
      <div class="flex justify-center">
        <div>
          <label for="datePicker" class="text-[#25a1c2] block mb-2">üìÖ Select Date (Required)</label>
          <input id="datePicker" class="p-2 rounded bg-[#111c28] border border-[#2ba8b8] text-white" placeholder="dd-mm-yyyy" required />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Front -->
        <div class="space-y-2">
          <label class="upload-btn" for="frontUpload">Upload Front View</label>
          <input type="file" id="frontUpload" accept="image/*">
          <div id="frontPreview" class="img-box"></div>
        </div>

        <!-- Side -->
        <div class="space-y-2">
          <label class="upload-btn" for="sideUpload">Upload Side View</label>
          <input type="file" id="sideUpload" accept="image/*">
          <div id="sidePreview" class="img-box"></div>
        </div>

        <!-- Back -->
        <div class="space-y-2">
          <label class="upload-btn" for="backUpload">Upload Back View</label>
          <input type="file" id="backUpload" accept="image/*">
          <div id="backPreview" class="img-box"></div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex justify-center gap-6 mt-6">
        <button id="saveBtn" class="px-4 py-2 bg-green-600 rounded" disabled>üíæ Save Progress</button>
        <button id="resetBtn" class="px-4 py-2 bg-yellow-600 rounded">üîÅ Reset Inputs</button>
      </div>
    </div>
  </div>

  <!-- Saved Timeline - Now in its own container -->
  <div class="saved-progress-container">
    <div class="flex justify-between items-center">
      <h3 class="text-xl font-semibold text-[#25a1c2] mt-10 mb-4">üìÖ Saved Progress</h3>
      <div class="flex gap-4">
        <button id="compareBtn" class="px-4 py-2 bg-blue-600 rounded text-sm" disabled>üîç Compare Progress</button>
        <button id="resetAllProgressBtn" class="px-4 py-2 bg-red-600 rounded text-sm">üóëÔ∏è Reset All Progress</button>
      </div>
    </div>
    <div id="savedTimeline" class="space-y-6"></div>
  </div>

  <!-- Comparison Modal -->
  <div id="compareModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">√ó</span>
      <h3 class="text-xl font-semibold text-[#25a1c2] mb-4">Compare Progress</h3>
      <div id="compareContent" class="flex flex-col gap-4"></div>
      <div class="flex justify-end mt-4">
        <button id="closeCompareBtn" class="px-4 py-2 bg-gray-600 rounded text-sm">Close Comparison</button>
      </div>
    </div>
  </div>

  <script>
    const datePicker = flatpickr("#datePicker", {
      dateFormat: "d-m-Y"
    });

    const files = { front: null, side: null, back: null };
    const previews = {
      front: document.getElementById("frontPreview"),
      side: document.getElementById("sidePreview"),
      back: document.getElementById("backPreview")
    };
    const saveBtn = document.getElementById("saveBtn");
    const resetBtn = document.getElementById("resetBtn");
    const resetAllProgressBtn = document.getElementById("resetAllProgressBtn");
    const compareBtn = document.getElementById("compareBtn");
    const compareModal = document.getElementById("compareModal");
    const compareContent = document.getElementById("compareContent");
    const closeModalBtn = document.querySelector(".close-btn");
    const closeCompareBtn = document.getElementById("closeCompareBtn");
    const dateInput = document.getElementById("datePicker");
    const logoUrl = "https://via.placeholder.com/300x400.png?text=Logo"; // Replace with your logo URL
    let savedEntries = JSON.parse(localStorage.getItem("progressEntries")) || [];
    const MAX_ENTRIES = 10;

    function isPortrait(img) {
      return img.naturalHeight > img.naturalWidth;
    }

    function compressImage(file, callback) {
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement("canvas");
          const MAX_WIDTH = 600;
          let width = img.width;
          let height = img.height;
          if (width > MAX_WIDTH) {
            height = (MAX_WIDTH / width) * height;
            width = MAX_WIDTH;
          }
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, width, height);
          canvas.toBlob(
            (blob) => {
              const compressedReader = new FileReader();
              compressedReader.onload = () => callback(compressedReader.result);
              compressedReader.readAsDataURL(blob);
            },
            "image/jpeg",
            0.7 // Quality: 70%
          );
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    }

    function updateSaveButtonState() {
      const hasDate = dateInput.value;
      const hasImage = files.front || files.side || files.back;
      saveBtn.disabled = !(hasDate && hasImage);
    }

    function updateCompareButtonState() {
      compareBtn.disabled = savedEntries.length < 2;
    }

    function saveToLocalStorage() {
      try {
        localStorage.setItem("progressEntries", JSON.stringify(savedEntries));
        updateCompareButtonState();
      } catch (e) {
        if (e.name === "QuotaExceededError") {
          alert("Storage limit reached! Please delete some saved progress entries to add new ones.");
          savedEntries.pop(); // Remove the last entry to prevent corruption
          renderSavedEntries();
        }
      }
    }

    function renderImagePreview(input, view, key) {
      const file = input.files[0];
      if (!file) return;

      compressImage(file, (compressedDataUrl) => {
        const img = new Image();
        img.onload = () => {
          if (!isPortrait(img)) {
            alert(`Please upload a portrait-oriented image for ${key.charAt(0).toUpperCase() + key.slice(1)} View (height should be greater than width).`);
            document.getElementById(`${key}Upload`).value = "";
            return;
          }
          files[key] = compressedDataUrl;
          view.innerHTML = `
            <div class="relative inline-block">
              <img src="${compressedDataUrl}" class="rounded mt-2" />
              <button onclick="removeImage('${key}')" class="absolute top-1 right-1 bg-red-600 text-white rounded px-2 text-sm">‚úñ</button>
            </div>`;
          updateSaveButtonState();
        };
        img.src = compressedDataUrl;
      });
    }

    function removeImage(key) {
      files[key] = null;
      document.getElementById(`${key}Upload`).value = "";
      previews[key].innerHTML = "";
      updateSaveButtonState();
    }

    function resetAllInputs() {
      ["front", "side", "back"].forEach(key => removeImage(key));
      dateInput.value = "";
      datePicker.clear();
      updateSaveButtonState();
    }

    function clearAllSavedProgress() {
      document.getElementById("savedTimeline").innerHTML = "";
      savedEntries = [];
      localStorage.removeItem("progressEntries");
      updateCompareButtonState();
    }

    function formatMonthYear(dateStr) {
      if (!dateStr) {
        const now = new Date();
        return now.toLocaleString("default", { month: "long", year: "numeric" });
      }
      const [d, m, y] = dateStr.split("-");
      const date = new Date(`${y}-${m}-${d}`);
      return date.toLocaleString("default", { month: "long", year: "numeric" });
    }

    function renderSavedEntries() {
      const timeline = document.getElementById("savedTimeline");
      timeline.innerHTML = "";
      savedEntries.forEach(entry => {
        const wrapper = document.createElement("div");
        wrapper.className = "p-4 border border-[#2ba8b8] rounded bg-[#111c28]";
        wrapper.dataset.date = entry.date;
        wrapper.innerHTML = `
          <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-2">
              <input type="checkbox" class="compare-checkbox" data-date="${entry.date}">
              <span class="text-[#25a1c2] font-bold">${formatMonthYear(entry.date)}</span>
            </div>
            <button class="delete-progress-btn text-red-500 text-sm">üóëÔ∏è Delete Progress</button>
          </div>
          <div class="flex flex-nowrap gap-4 overflow-x-auto"> <!-- Changed flex-wrap to flex-nowrap and added overflow-x-auto -->
            <div class="text-center">
              <img src="${entry.front || logoUrl}" class="${entry.front ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
              <p class="text-[#25a1c2] mt-2">Front View</p>
            </div>
            <div class="text-center">
              <img src="${entry.side || logoUrl}" class="${entry.side ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
              <p class="text-[#25a1c2] mt-2">Side View</p>
            </div>
            <div class="text-center">
              <img src="${entry.back || logoUrl}" class="${entry.back ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
              <p class="text-[#25a1c2] mt-2">Back View</p>
            </div>
          </div>`;
        timeline.prepend(wrapper);

        wrapper.querySelector(".delete-progress-btn").addEventListener("click", () => {
          savedEntries = savedEntries.filter(e => e.date !== entry.date);
          saveToLocalStorage();
          wrapper.remove();
        });

        wrapper.querySelector(".compare-checkbox").addEventListener("change", () => {
          const checkedCount = document.querySelectorAll(".compare-checkbox:checked").length;
          if (checkedCount > 2) {
            wrapper.querySelector(".compare-checkbox").checked = false;
            alert("You can only select two entries for comparison.");
          }
        });
      });
      updateCompareButtonState();
    }

    function renderComparisonModal(selectedEntries) {
      if (selectedEntries.length !== 2) {
        alert("Please select exactly two entries to compare.");
        return;
      }
      compareModal.style.display = "block";
      compareContent.innerHTML = `
        <div class="grid grid-cols-2 gap-4">
          ${selectedEntries.map((entry, index) => `
            <div>
              <h4 class="text-[#25a1c2] font-semibold mb-2">${formatMonthYear(entry.date)}</h4>
              <div class="flex flex-col gap-2">
                <div class="text-center">
                  <img src="${entry.front || logoUrl}" class="${entry.front ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
                  <p class="text-[#25a1c2] mt-2">Front View</p>
                </div>
                <div class="text-center">
                  <img src="${entry.side || logoUrl}" class="${entry.side ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
                  <p class="text-[#25a1c2] mt-2">Side View</p>
                </div>
                <div class="text-center">
                  <img src="${entry.back || logoUrl}" class="${entry.back ? 'saved-img' : 'logo-img'} rounded border border-[#2ba8b8]" />
                  <p class="text-[#25a1c2] mt-2">Back View</p>
                </div>
              </div>
            </div>
          `).join('')}
        </div>`;
    }

    function closeComparison() {
      compareModal.style.display = "none";
      document.querySelectorAll(".compare-checkbox").forEach(cb => cb.checked = false);
    }

    document.getElementById("frontUpload").addEventListener("change", function () {
      renderImagePreview(this, previews.front, "front");
    });
    document.getElementById("sideUpload").addEventListener("change", function () {
      renderImagePreview(this, previews.side, "side");
    });
    document.getElementById("backUpload").addEventListener("change", function () {
      renderImagePreview(this, previews.back, "back");
    });

    dateInput.addEventListener("change", updateSaveButtonState);

    resetBtn.addEventListener("click", resetAllInputs);

    resetAllProgressBtn.addEventListener("click", clearAllSavedProgress);

    saveBtn.addEventListener("click", () => {
      const dateStr = dateInput.value;
      const hasImage = files.front || files.side || files.back;
      if (!dateStr || !hasImage) {
        alert("Please select a date and upload at least one image to save progress.");
        return;
      }
      if (savedEntries.length >= MAX_ENTRIES) {
        alert(`You can only save up to ${MAX_ENTRIES} progress entries. Please delete some entries to add a new one.`);
        return;
      }
      const entry = {
        date: dateStr,
        front: files.front,
        side: files.side,
        back: files.back
      };
      savedEntries.push(entry);
      saveToLocalStorage();
      renderSavedEntries();
      resetAllInputs();
    });

    compareBtn.addEventListener("click", () => {
      const checkedBoxes = document.querySelectorAll(".compare-checkbox:checked");
      const selectedDates = Array.from(checkedBoxes).map(cb => cb.dataset.date);
      const selectedEntries = savedEntries.filter(entry => selectedDates.includes(entry.date));
      renderComparisonModal(selectedEntries);
    });

    closeModalBtn.addEventListener("click", closeComparison);

    closeCompareBtn.addEventListener("click", closeComparison);

    compareModal.addEventListener("click", (e) => {
      if (e.target === compareModal) {
        closeComparison();
      }
    });

    // Load saved entries on page load
    renderSavedEntries();
  </script>
</body>
</html>
